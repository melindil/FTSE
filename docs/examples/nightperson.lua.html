<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>FTSE Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>FTSE</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Examples</h2>
<ul class="nowrap">
  <li><a href="../examples/armorattachedweapon.lua.html">armorattachedweapon.lua</a></li>
  <li><a href="../examples/hulksmash.lua.html">hulksmash.lua</a></li>
  <li><a href="../examples/missionvariables.lua.html">missionvariables.lua</a></li>
  <li><strong>nightperson.lua</strong></li>
</ul>
<h2>Entity classes</h2>
<ul class="nowrap">
  <li><a href="../entity classes/Actor.html">Actor</a></li>
  <li><a href="../entity classes/Alarm.html">Alarm</a></li>
  <li><a href="../entity classes/Ammo.html">Ammo</a></li>
  <li><a href="../entity classes/Armour.html">Armour</a></li>
  <li><a href="../entity classes/BaseAI.html">BaseAI</a></li>
  <li><a href="../entity classes/Book.html">Book</a></li>
  <li><a href="../entity classes/Breakable.html">Breakable</a></li>
  <li><a href="../entity classes/CaptureInvItem.html">CaptureInvItem</a></li>
  <li><a href="../entity classes/CaptureItem.html">CaptureItem</a></li>
  <li><a href="../entity classes/Collectable.html">Collectable</a></li>
  <li><a href="../entity classes/CombatFX.html">CombatFX</a></li>
  <li><a href="../entity classes/Consumable.html">Consumable</a></li>
  <li><a href="../entity classes/Container.html">Container</a></li>
  <li><a href="../entity classes/Controller.html">Controller</a></li>
  <li><a href="../entity classes/Deathtrap.html">Deathtrap</a></li>
  <li><a href="../entity classes/Door.html">Door</a></li>
  <li><a href="../entity classes/EffectSpawn.html">EffectSpawn</a></li>
  <li><a href="../entity classes/Entity.html">Entity</a></li>
  <li><a href="../entity classes/Geiger.html">Geiger</a></li>
  <li><a href="../entity classes/GenericItem.html">GenericItem</a></li>
  <li><a href="../entity classes/Holodisk.html">Holodisk</a></li>
  <li><a href="../entity classes/Inventory.html">Inventory</a></li>
  <li><a href="../entity classes/Keys.html">Keys</a></li>
  <li><a href="../entity classes/Light.html">Light</a></li>
  <li><a href="../entity classes/Lockpick.html">Lockpick</a></li>
  <li><a href="../entity classes/Powernode.html">Powernode</a></li>
  <li><a href="../entity classes/Radiation.html">Radiation</a></li>
  <li><a href="../entity classes/RepairObject.html">RepairObject</a></li>
  <li><a href="../entity classes/RotatingDoor.html">RotatingDoor</a></li>
  <li><a href="../entity classes/Scenary.html">Scenary</a></li>
  <li><a href="../entity classes/ScenaryMove.html">ScenaryMove</a></li>
  <li><a href="../entity classes/ScenarySpawn.html">ScenarySpawn</a></li>
  <li><a href="../entity classes/ScienceSwitch.html">ScienceSwitch</a></li>
  <li><a href="../entity classes/SentryAI.html">SentryAI</a></li>
  <li><a href="../entity classes/SkillConsumable.html">SkillConsumable</a></li>
  <li><a href="../entity classes/Sneak.html">Sneak</a></li>
  <li><a href="../entity classes/SpawnPoint.html">SpawnPoint</a></li>
  <li><a href="../entity classes/StateBreakable.html">StateBreakable</a></li>
  <li><a href="../entity classes/StateScenary.html">StateScenary</a></li>
  <li><a href="../entity classes/Switch.html">Switch</a></li>
  <li><a href="../entity classes/Trap.html">Trap</a></li>
  <li><a href="../entity classes/TrapTrigger.html">TrapTrigger</a></li>
  <li><a href="../entity classes/Usable.html">Usable</a></li>
  <li><a href="../entity classes/Vehicle.html">Vehicle</a></li>
  <li><a href="../entity classes/VehicleController.html">VehicleController</a></li>
  <li><a href="../entity classes/VehicleWeapon.html">VehicleWeapon</a></li>
  <li><a href="../entity classes/Waypoint.html">Waypoint</a></li>
  <li><a href="../entity classes/Weapon.html">Weapon</a></li>
  <li><a href="../entity classes/WeaponMode.html">WeaponMode</a></li>
</ul>
<h2>Hooks</h2>
<ul class="nowrap">
  <li><a href="../hooks/Hooks.html">Hooks</a></li>
</ul>
<h2>Global Classes</h2>
<ul class="nowrap">
  <li><a href="../global classes/DefaultStyle.html">DefaultStyle</a></li>
  <li><a href="../global classes/hookexecutor.html">hookexecutor</a></li>
  <li><a href="../global classes/logger.html">logger</a></li>
  <li><a href="../global classes/world.html">world</a></li>
</ul>
<h2>Manual</h2>
<ul class="nowrap">
  <li><a href="../manual/01-introduction.md.html">Introduction</a></li>
  <li><a href="../manual/02-installation.md.html">Installation Instructions</a></li>
  <li><a href="../manual/03-patches.md.html">EXE Patches</a></li>
  <li><a href="../manual/04-scripting.md.html">LUA Scripting</a></li>
</ul>

</div>

<div id="content">

    <h2>nightperson.lua</h2>
<pre>
<span class="comment">--[[

In this example, we will recreate the Night Person trait as a perk,
 with the following differences:

* The perk will work as described, giving -1 to PE and IN during daytime and +1 to PE and IN during night time.
* The perk will apply the +1/-1 stats as temporary modifiers rather than permanent ones. Among other things, this will result in them being highlighted in blue or red, and will make it so that the character's perk selection is (correctly) not affected by the bonus/penalty.

--]]</span>

<span class="comment">-- <a href="../hooks/Hooks.html#OnStart">OnStart</a> hook function
</span><span class="keyword">function</span> OnStart ()
  <span class="comment">-- We create the new perk by using the <a href="../global classes/hookexecutor.html#hookexecutor:ReplacePerk">hookexecutor:ReplacePerk</a>
</span>  <span class="comment">-- function at game startup.
</span>  <span class="comment">-- Very simple requirement for testing, level 3 only
</span>  newperk = {name = <span class="string">"nightPersonPerk"</span>,
               minlevel = <span class="number">3</span>,
               maxperktaken = <span class="number">1</span>
              }
  <span class="comment">-- Replace unused perk 18 "fortuneFinder"
</span>  hookexecutor:ReplacePerk(newperk, <span class="number">18</span>)

<span class="keyword">end</span>

<span class="comment">-- <a href="../hooks/Hooks.html#OnLocaleLoad">OnLocaleLoad</a> hook function
</span><span class="keyword">function</span> OnLocaleLoad()
  <span class="comment">-- Locale strings can either be added directly to the game's .txt
</span>  <span class="comment">-- files, or included in the OnLocaleLoad function. Here, we
</span>  <span class="comment">-- define the name and description strings for our new perk.
</span>  <span class="comment">-- Use <a href="../global classes/hookexecutor.html#hookexecutor:AddLocaleString">hookexecutor:AddLocaleString</a> to add the strings.
</span>    hookexecutor:AddLocaleString(<span class="string">"name_nightPersonPerk"</span>,<span class="string">"Night Person"</span>)
    hookexecutor:AddLocaleString(<span class="string">"desc_nightPersonPerk"</span>,<span class="string">"Perk demonstrating game timer routines"</span>)

<span class="keyword">end</span>

<span class="comment">-- <a href="../hooks/Hooks.html#OnLongTick">Hooks:OnLongTick</a> hook function
</span><span class="keyword">function</span> OnLongTick(e)

  <span class="comment">-- Check if character has the Night Person
</span>  <span class="keyword">if</span> e:GetAttribute(<span class="string">"nightPersonPerk"</span>, ACTOR_TABLE_CURRENT) &gt; <span class="number">0</span> <span class="keyword">then</span>

    <span class="comment">-- use perk entry in temporary table to save info about
</span>    <span class="comment">-- penalty (=1), bonus (=2), or neither (=0) is applied.
</span>    curr = e:GetAttribute(<span class="string">"nightPersonPerk"</span>, ACTOR_TABLE_TEMPORARY)
    now = world:GetTime()

    <span class="keyword">if</span> now[<span class="string">"hour"</span>] &lt; <span class="number">8</span> <span class="keyword">or</span> now[<span class="string">"hour"</span>] &gt; <span class="number">19</span> <span class="keyword">then</span>

      <span class="comment">-- night time: apply bonus if none yet or on penalty
</span>
      <span class="keyword">if</span> curr == <span class="number">0</span> <span class="keyword">then</span>

        <span class="comment">-- Nothing applied yet - apply the bonus. The second
</span>        <span class="comment">-- parameter to <a href="../entity classes/Actor.html#ApplyBonus">ApplyBonus</a>
</span>        <span class="comment">-- indicates if the bonus is temporary (false) or permanent (true)
</span>        bonus = { perception=<span class="number">1</span>, intelligence=<span class="number">1</span> }
        e:ApplyBonus(bonus,<span class="keyword">false</span>)

        <span class="comment">-- Use <a href="../entity classes/Actor.html#SetAttribute">Actor:SetAttribute</a> to save bonus applied:
</span>        e:SetAttribute(<span class="string">"nightPersonPerk"</span>, ACTOR_TABLE_TEMPORARY, <span class="number">2</span>)

      <span class="keyword">elseif</span> curr == <span class="number">1</span> <span class="keyword">then</span>

        <span class="comment">-- Penalty currently applied. Override it with extra bonus
</span>        bonus = { perception=<span class="number">2</span>, intelligence=<span class="number">2</span> }
        e:ApplyBonus(bonus,<span class="keyword">false</span>)

        <span class="comment">-- Use <a href="../entity classes/Actor.html#SetAttribute">Actor:SetAttribute</a> to save bonus applied:
</span>        e:SetAttribute(<span class="string">"nightPersonPerk"</span>, ACTOR_TABLE_TEMPORARY, <span class="number">2</span>)
      <span class="keyword">end</span>
    <span class="keyword">else</span>

      <span class="comment">-- day time case : apply penalty if none yet or on bonus
</span>      <span class="keyword">if</span> curr == <span class="number">0</span> <span class="keyword">then</span>

        <span class="comment">-- Nothing applied yet
</span>        bonus = { perception=<span class="number">1</span>, intelligence=<span class="number">1</span> }
        e:RemoveBonus(bonus,<span class="keyword">false</span>)

        <span class="comment">-- Use <a href="../entity classes/Actor.html#SetAttribute">Actor:SetAttribute</a> to save penalty applied:
</span>        e:SetAttribute(<span class="string">"nightPersonPerk"</span>, ACTOR_TABLE_TEMPORARY, <span class="number">1</span>)

      <span class="keyword">elseif</span> curr == <span class="number">2</span> <span class="keyword">then</span>

        <span class="comment">-- Bonus is applied - apply extra penalty to counter it
</span>        bonus = { perception=<span class="number">2</span>, intelligence=<span class="number">2</span> }
        e:RemoveBonus(bonus,<span class="keyword">false</span>)

        <span class="comment">-- Use <a href="../entity classes/Actor.html#SetAttribute">Actor:SetAttribute</a> to save penalty applied:
</span>        e:SetAttribute(<span class="string">"nightPersonPerk"</span>, ACTOR_TABLE_TEMPORARY, <span class="number">1</span>)
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-05-07 19:14:47 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
