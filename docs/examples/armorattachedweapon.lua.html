<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>FTSE Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>FTSE</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Examples</h2>
<ul class="nowrap">
  <li><strong>armorattachedweapon.lua</strong></li>
  <li><a href="../examples/hulksmash.lua.html">hulksmash.lua</a></li>
  <li><a href="../examples/missionvariables.lua.html">missionvariables.lua</a></li>
  <li><a href="../examples/nightperson.lua.html">nightperson.lua</a></li>
  <li><a href="../examples/vtableexample.lua.html">vtableexample.lua</a></li>
</ul>
<h2>Entity classes</h2>
<ul class="nowrap">
  <li><a href="../entity classes/Actor.html">Actor</a></li>
  <li><a href="../entity classes/Alarm.html">Alarm</a></li>
  <li><a href="../entity classes/Ammo.html">Ammo</a></li>
  <li><a href="../entity classes/Armour.html">Armour</a></li>
  <li><a href="../entity classes/BaseAI.html">BaseAI</a></li>
  <li><a href="../entity classes/Book.html">Book</a></li>
  <li><a href="../entity classes/Breakable.html">Breakable</a></li>
  <li><a href="../entity classes/CaptureInvItem.html">CaptureInvItem</a></li>
  <li><a href="../entity classes/CaptureItem.html">CaptureItem</a></li>
  <li><a href="../entity classes/Collectable.html">Collectable</a></li>
  <li><a href="../entity classes/CombatFX.html">CombatFX</a></li>
  <li><a href="../entity classes/Consumable.html">Consumable</a></li>
  <li><a href="../entity classes/Container.html">Container</a></li>
  <li><a href="../entity classes/Controller.html">Controller</a></li>
  <li><a href="../entity classes/Deathtrap.html">Deathtrap</a></li>
  <li><a href="../entity classes/Door.html">Door</a></li>
  <li><a href="../entity classes/EffectSpawn.html">EffectSpawn</a></li>
  <li><a href="../entity classes/Entity.html">Entity</a></li>
  <li><a href="../entity classes/Geiger.html">Geiger</a></li>
  <li><a href="../entity classes/GenericItem.html">GenericItem</a></li>
  <li><a href="../entity classes/Holodisk.html">Holodisk</a></li>
  <li><a href="../entity classes/Inventory.html">Inventory</a></li>
  <li><a href="../entity classes/Keys.html">Keys</a></li>
  <li><a href="../entity classes/Light.html">Light</a></li>
  <li><a href="../entity classes/Lockpick.html">Lockpick</a></li>
  <li><a href="../entity classes/Powernode.html">Powernode</a></li>
  <li><a href="../entity classes/Radiation.html">Radiation</a></li>
  <li><a href="../entity classes/RepairObject.html">RepairObject</a></li>
  <li><a href="../entity classes/RotatingDoor.html">RotatingDoor</a></li>
  <li><a href="../entity classes/Scenary.html">Scenary</a></li>
  <li><a href="../entity classes/ScenaryMove.html">ScenaryMove</a></li>
  <li><a href="../entity classes/ScenarySpawn.html">ScenarySpawn</a></li>
  <li><a href="../entity classes/ScienceSwitch.html">ScienceSwitch</a></li>
  <li><a href="../entity classes/SentryAI.html">SentryAI</a></li>
  <li><a href="../entity classes/SkillConsumable.html">SkillConsumable</a></li>
  <li><a href="../entity classes/Sneak.html">Sneak</a></li>
  <li><a href="../entity classes/SpawnPoint.html">SpawnPoint</a></li>
  <li><a href="../entity classes/StateBreakable.html">StateBreakable</a></li>
  <li><a href="../entity classes/StateScenary.html">StateScenary</a></li>
  <li><a href="../entity classes/Switch.html">Switch</a></li>
  <li><a href="../entity classes/Trap.html">Trap</a></li>
  <li><a href="../entity classes/TrapTrigger.html">TrapTrigger</a></li>
  <li><a href="../entity classes/Usable.html">Usable</a></li>
  <li><a href="../entity classes/Vehicle.html">Vehicle</a></li>
  <li><a href="../entity classes/VehicleController.html">VehicleController</a></li>
  <li><a href="../entity classes/VehicleWeapon.html">VehicleWeapon</a></li>
  <li><a href="../entity classes/Waypoint.html">Waypoint</a></li>
  <li><a href="../entity classes/Weapon.html">Weapon</a></li>
  <li><a href="../entity classes/WeaponMode.html">WeaponMode</a></li>
</ul>
<h2>Vtable functions</h2>
<ul class="nowrap">
  <li><a href="../vtable functions/Entity_Vtable.html">Entity_Vtable</a></li>
</ul>
<h2>Hooks</h2>
<ul class="nowrap">
  <li><a href="../hooks/Hooks.html">Hooks</a></li>
</ul>
<h2>Global Classes</h2>
<ul class="nowrap">
  <li><a href="../global classes/DefaultStyle.html">DefaultStyle</a></li>
  <li><a href="../global classes/hookexecutor.html">hookexecutor</a></li>
  <li><a href="../global classes/logger.html">logger</a></li>
  <li><a href="../global classes/world.html">world</a></li>
</ul>
<h2>Manual</h2>
<ul class="nowrap">
  <li><a href="../manual/01-introduction.md.html">Introduction</a></li>
  <li><a href="../manual/02-installation.md.html">Installation Instructions</a></li>
  <li><a href="../manual/03-patches.md.html">EXE Patches</a></li>
  <li><a href="../manual/04-scripting.md.html">LUA Scripting</a></li>
  <li><a href="../manual/05-vtables.md.html">Calling and Hooking Entity Vtable Functions</a></li>
</ul>

</div>

<div id="content">

    <h2>armorattachedweapon.lua</h2>
<pre>
<span class="comment">--[[

For this example, we will be modifying the Environmental Armour to include
an attached weapon; in this case, the Gauss Rifle.  The rifle should be
automatically equipped and unequipped when the corresponding armor is put on
or taken off, and should not be otherwise removable from the character.

--]]</span>

<span class="comment">-- Hook OnEquip to add the weapon to slot 1 (right hand)
</span><span class="keyword">function</span> OnEquip(equipper, item, slot)

	<span class="comment">-- Is this an environmental armour?
</span>	<span class="keyword">if</span> item:GetInternalName() == <span class="string">"bosEnviro"</span> <span class="keyword">and</span> slot == EQUIP_SLOT_ARMOR <span class="keyword">then</span>

		<span class="comment">-- Yes, make a weapon entity and equip it
</span>		<span class="keyword">local</span> newent = world:CreateEntity(<span class="string">"entities/weapons/Rifles/gaussRifle.ent"</span>,EQUIP_SLOT_RIGHT)
		<span class="keyword">local</span> prevequip,errstr = equipper:EquipItem(newent, EQUIP_SLOT_RIGHT)
		<span class="keyword">if</span> errstr ~= <span class="keyword">nil</span> <span class="keyword">then</span>
			<span class="comment">-- We failed to equip: This means we got back the entity we tried to
</span>			<span class="comment">-- equip, so just drop it
</span>			prevequip:Destruct()
		<span class="keyword">else</span>
			<span class="comment">-- Succeeded on equipping. This means we may have gotten back the
</span>			<span class="comment">-- character's previously equipped item.  Put it in the inventory
</span>			<span class="comment">-- if we got something that isn't the null entity.
</span>			<span class="keyword">if</span> prevequip.ClassType ~= <span class="string">"Entity"</span> <span class="keyword">then</span>
				equipper:AddToInventory(prevequip)
			<span class="keyword">end</span>
		<span class="keyword">end</span>
	<span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">-- Hook OnUnequip to remove the weapon from slot 1 and destruct it
</span><span class="keyword">function</span> OnUnequip(equipper, item, slot)

	<span class="comment">-- Is this an environmental armour?
</span>	<span class="keyword">if</span> item:GetInternalName() == <span class="string">"bosEnviro"</span> <span class="keyword">and</span> slot == EQUIP_SLOT_ARMOR <span class="keyword">then</span>

		<span class="comment">-- Yes, unequip the added item and destruct it
</span>		<span class="comment">-- Not destructing the entity will leak resources
</span>		<span class="keyword">local</span> removedent = equipper:UnequipItem(EQUIP_SLOT_RIGHT)
		removedent:Destruct()
	<span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">-- Hook OnCheckUnequip to disallow removal of the weapon when armor is equipped
</span><span class="comment">-- Note that this code doesn't work perfectly if the item exists independently
</span><span class="comment">-- of the armor; specifically, if the character already has that weapon equipped
</span><span class="comment">-- in slot 1, and tries to equip the armor, it will fail.
</span>
<span class="keyword">function</span> OnCheckUnequip(equipper, item, slot)

	<span class="comment">-- Is this a gauss rifle in slot 1?
</span>	<span class="keyword">if</span> item:GetInternalName() == <span class="string">"gaussRifle"</span> <span class="keyword">and</span> slot == EQUIP_SLOT_RIGHT <span class="keyword">then</span>

		<span class="comment">-- Is character wearing environmental armour?
</span>		<span class="keyword">if</span> equipper:GetEquippedItem(EQUIP_SLOT_ARMOR):GetInternalName() == <span class="string">"bosEnviro"</span> <span class="keyword">then</span>

			<span class="comment">-- Yes, disallow the operation
</span>			<span class="keyword">return</span> <span class="string">"cannotRemove"</span>
		<span class="keyword">end</span>
	<span class="keyword">end</span>
	<span class="keyword">return</span>
<span class="keyword">end</span></pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2024-08-15 12:18:22 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
